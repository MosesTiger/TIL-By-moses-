# Next.js 서버 액션 및 리디렉션

## 소개
이 문서는 Next.js 서버 액션에서 사용되는 주요 개념을 설명합니다. 여기에는 폼 데이터 처리, 검증, 데이터베이스 삽입, 캐시 재검증 및 사용자 리디렉션에 중점을 둡니다.

## 폼 데이터 처리 및 검증

### FormSchema
- **FormSchema**: `zod`를 사용하여 폼 데이터의 구조를 검증하는 스키마입니다. `id`, `customerId`, `amount`, `status`, `date`와 같은 필드를 포함합니다.
- **CreateInvoice**: 새 청구서를 생성하기 위해 특정 필드(`id` 및 `date`)를 생략한 `FormSchema`의 부분 집합입니다.

### 폼 데이터 파싱
- `formData` 객체에서 데이터를 추출하고 `FormSchema.parse()`를 사용하여 검증합니다.
- `customerId`, `amount`, `status`와 같은 필드를 검증합니다.

## 데이터베이스 삽입

### SQL 삽입
- SQL 쿼리를 사용하여 검증된 데이터를 `invoices` 테이블에 삽입합니다.
- 삽입되는 필드에는 `customer_id`, `amount`, `status`, `date`가 포함됩니다.
- 삽입 전에 금액을 센트로 변환합니다.
- 날짜는 `YYYY-MM-DD` 형식으로 포맷됩니다.

## 캐시 재검증

### revalidatePath
- 인보이스 페이지의 경로(`/dashboard/invoices`)를 사용하여 `revalidatePath`를 호출합니다.
- 새로 추가된 청구서가 반영되도록 캐시를 업데이트합니다.

## 사용자 리디렉션

### redirect
- **목적**: 서버 사이드 액션 후 사용자를 지정된 경로로 자동으로 이동시킵니다.
- **사용법**: 대상 경로(`/dashboard/invoices`)와 함께 `redirect`를 호출합니다.
- **시나리오**: 청구서 생성이 성공적으로 완료된 후 사용자를 청구서 목록 페이지로 리디렉션하는 데 사용됩니다.

## 결론
이러한 개념들은 Next.js 애플리케이션에서 원활한 데이터 처리, 검증 및 사용자 경험을 보장합니다. 서버 액션, 스키마 검증 및 자동 리디렉션을 활용하여 효율적으로 애플리케이션을 구축할 수 있습니다.
